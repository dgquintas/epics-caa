{% extends "base.html" %}

{% block scripts %}
<script src="{{ static_url("js/jquery.timeago.js") }}"></script>
<script type="text/javascript">
$(document).ready(function() {
    $(".timeago").timeago();
    });
</script>
{% end %}

{% block contents %}

<div class="hero-unit" style="text-align: center;">
    <h1>EPICS Casssandra Archiver</h1>
</div>

<div class="row">
<h1>Subscribed PVs</h1>
<div class="row">
<div class="span8">
{% if apvs %}
<table class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>Name</th>
            <th>Mode</th>
            <th>Status</th>
            <th>Since</th>
        </tr>
    </thead>
    <tbody>
        {% for apv in apvs %}
            {% set pvname = apv['name'] %}
            {% set since = datetime.datetime.fromtimestamp(apv['since']/1e6) %}
            <tr>
            <td><a href="{{ reverse_url("pv", pvname) }}">{{ pvname }}</a></td>
            {% if apv['mode']['mode'] == 'Scan' %}
                <td style="width: 1px;"><span title="Period: {{ apv['mode']['period'] }}">{{ apv['mode']['mode'] }}</span></td>
            {% else %}
                <td style="width: 1px;"><span title="Delta: {{ apv['mode']['delta'] }}. Max. Freq: {{ apv['mode']['max_freq'] }}">{{ apv['mode']['mode'] }}</span></td>
            {% end %}
            {% if statuses[pvname]['connected'] %}
                <td style="width: 1px;"><span class="label label-success">Connected</span></td>
            {% else %}
                <td style="width: 1px;"><span class="label label-important">Not Connected</span></td>
            {% end %}
            <td>{{ since.ctime() }} (<span class="timeago" title="{% raw since.isoformat() %}"></span>)</td>
            </tr>
        {% end %}
    </tbody>
</table>
{% else %}
None!
{% end %}
</div>
</div>
</div>
{% end %}
